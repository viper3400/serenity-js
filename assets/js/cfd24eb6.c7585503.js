"use strict";(self.webpackChunk_documentation_serenity_js_org=self.webpackChunk_documentation_serenity_js_org||[]).push([[5963],{30876:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>g});var n=a(2784);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,g=m["".concat(s,".").concat(d)]||m[d]||c[d]||i;return a?n.createElement(g,o(o({ref:t},u),{},{components:a})):n.createElement(g,o({ref:t},u))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},33142:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(2784),r=a(6277);const i={tabItem:"tabItem_OMyP"};function o(e){let{children:t,hidden:a,className:o}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,o),hidden:a},t)}},43193:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(7896),r=a(2784),i=a(6277),o=a(25425),l=a(66806),s=a(50717);const p={tabList:"tabList_M0Dn",tabItem:"tabItem_ysIP"};function u(e){let{className:t,block:a,selectedValue:l,selectValue:s,tabValues:u}=e;const m=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.o5)(),d=e=>{const t=e.currentTarget,a=m.indexOf(t),n=u[a].value;n!==l&&(c(t),s(n))},g=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=m.indexOf(e.currentTarget)+1;t=m[a]??m[0];break}case"ArrowLeft":{const a=m.indexOf(e.currentTarget)-1;t=m[a]??m[m.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},t)},u.map((e=>{let{value:t,label:a,attributes:o}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>m.push(e),onKeyDown:g,onClick:d},o,{className:(0,i.Z)("tabs__item",p.tabItem,o?.className,{"tabs__item--active":l===t})}),a??t)})))}function m(e){let{lazy:t,children:a,selectedValue:n}=e;const i=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function c(e){const t=(0,l.Y)(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",p.tabList)},r.createElement(u,(0,n.Z)({},e,t)),r.createElement(m,(0,n.Z)({},e,t)))}function d(e){const t=(0,s.Z)();return r.createElement(c,(0,n.Z)({key:String(t)},e))}},66806:(e,t,a)=>{a.d(t,{Y:()=>c});var n=a(2784),r=a(7267),i=a(24236),o=a(53432),l=a(79675);function s(e){return function(e){return n.Children.map(e,(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function p(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??s(a);return function(e){const t=(0,o.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function u(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:a}=e;const o=(0,r.k6)(),l=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,i._X)(l),(0,n.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(o.location.search);t.set(l,e),o.replace({...o.location,search:t.toString()})}),[l,o])]}function c(e){const{defaultValue:t,queryString:a=!1,groupId:r}=e,i=p(e),[o,s]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!u({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i}))),[c,d]=m({queryString:a,groupId:r}),[g,h]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,i]=(0,l.Nk)(a);return[r,(0,n.useCallback)((e=>{a&&i.set(e)}),[a,i])]}({groupId:r}),b=(()=>{const e=c??g;return u({value:e,tabValues:i})?e:null})();(0,n.useLayoutEffect)((()=>{b&&s(b)}),[b]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!u({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);s(e),d(e),h(e)}),[d,h,i]),tabValues:i}}},88669:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>g,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var n=a(7896),r=(a(2784),a(30876)),i=a(43193),o=a(33142);const l={title:"GitLab CI"},s="Continuous Testing with GitLab CI",p={unversionedId:"integration/gitlab-ci",id:"integration/gitlab-ci",title:"GitLab CI",description:"Serenity/JS integrates with industry-standard test runners, build tools, and CI/CD pipelines",source:"@site/docs/integration/gitlab-ci.mdx",sourceDirName:"integration",slug:"/integration/gitlab-ci",permalink:"/handbook/integration/gitlab-ci",draft:!1,editUrl:"https://github.com/serenity-js/serenity-js/tree/main/documentation/serenity-js.org/docs/integration/gitlab-ci.mdx",tags:[],version:"current",frontMatter:{title:"GitLab CI"},sidebar:"tutorialSidebar",previous:{title:"GitHub Actions",permalink:"/handbook/integration/github-actions"},next:{title:"Jenkins CI",permalink:"/handbook/integration/jenkins-ci"}},u={},m=[{value:"Writing tests",id:"writing-tests",level:2},{value:"Running tests on GitLab CI",id:"running-tests-on-gitlab-ci",level:2},{value:"Generating Serenity BDD reports",id:"generating-serenity-bdd-reports",level:2},{value:"Installing a Java Runtime Environment",id:"installing-a-java-runtime-environment",level:3},{value:"Building a custom Docker image",id:"building-a-custom-docker-image",level:3},{value:"Publishing Serenity BDD reports to GitLab Pages",id:"publishing-serenity-bdd-reports-to-gitlab-pages",level:2},{value:"Generating JUnit reports",id:"generating-junit-reports",level:2},{value:"Next steps",id:"next-steps",level:2}],c={toc:m},d="wrapper";function g(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"continuous-testing-with-gitlab-ci"},"Continuous Testing with GitLab CI"),(0,r.kt)("p",null,"Serenity/JS integrates with ",(0,r.kt)("a",{parentName:"p",href:"/handbook/test-runners/"},"industry-standard test runners"),", build tools, and ",(0,r.kt)("abbr",{title:"Continuous Integration and Delivery"},"CI/CD")," pipelines\nto help your team ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/introduction/index.html#introduction-to-cicd-methodologies"},"continuously deliver")," high-quality software."),(0,r.kt)("p",null,"In this article, I'll show you how to configure ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/introduction/"},"GitLab CI"),"\nto run automated acceptance tests built using Serenity/JS and publish test execution reports and living documentation to GitLab Pages, so that you can share them with your team."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"You will learn:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How to run Serenity/JS test scenarios as part of a GitLab CI pipeline"),(0,r.kt)("li",{parentName:"ul"},"How to produce Serenity BDD reports and living documentation and publish them to GitLab Pages"),(0,r.kt)("li",{parentName:"ul"},"How to make your test suite produce JUnit-standard reports and use them to decorate GitLab Merge Requests")),(0,r.kt)("h2",{id:"writing-tests"},"Writing tests"),(0,r.kt)("p",null,"To run your automated tests on GitLab CI you first need to write them \ud83d\ude0a\nThe easiest way to get started with automating tests using Serenity/JS is to use one of the available ",(0,r.kt)("a",{parentName:"p",href:"/handbook/getting-started/project-templates/"},(0,r.kt)("strong",{parentName:"a"},"Serenity/JS Project Templates")),"\nas they come with example scenarios and combine some of the most popular configurations of Serenity/JS modules and test automation tools:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/serenity-js/serenity-js-cucumber-template"},"REST API testing with Cucumber and Serenity/JS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/serenity-js/serenity-js-mocha-template"},"REST API testing with Mocha and Serenity/JS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/serenity-js/serenity-js-cucumber-playwright-template"},"Web testing with Cucumber, Playwright, and Serenity/JS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/serenity-js/serenity-js/tree/main/examples/playwright-test-todomvc"},"Web testing with Playwright Test and Serenity/JS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/serenity-js/serenity-js/tree/main/examples/webdriverio-mocha-todomvc"},"Web testing with WebdriverIO, Mocha, and Serenity/JS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/serenity-js/serenity-js-cucumber-webdriverio-template"},"Web testing with WebdriverIO, Cucumber, and Serenity/JS"))),(0,r.kt)("p",null,"If you're new to Serenity/JS, you might want to follow the ",(0,r.kt)("strong",{parentName:"p"},"tutorial")," to learn how to ",(0,r.kt)("a",{parentName:"p",href:"/handbook/web-testing/your-first-web-scenario"},(0,r.kt)("strong",{parentName:"a"},"write your first web scenario")),"!"),(0,r.kt)("h2",{id:"running-tests-on-gitlab-ci"},"Running tests on GitLab CI"),(0,r.kt)("p",null,"GitLab CI uses ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/docker/using_docker_images.html"},"Docker containers")," to run your ",(0,r.kt)("abbr",{title:"Continuous Integration and Delivery"},"CI/CD")," jobs.\nTo ensure maximum stability of your test suite, you should run Serenity/JS in a container that offers the latest ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nodejs/Release"},"Long-Term Support")," version of Node.js, as per the the ",(0,r.kt)("a",{parentName:"p",href:"/handbook/getting-started/installation"},"Serenity/JS installation guide"),"."),(0,r.kt)("p",null,"The exact ",(0,r.kt)("strong",{parentName:"p"},"Docker image")," you choose depends on the runtime dependencies required for your tests."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"REST API")," tests that don't require any web browsers should use the official plain Node.js image: ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/node"},(0,r.kt)("inlineCode",{parentName:"a"},"node:lts"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Web tests")," using ",(0,r.kt)("strong",{parentName:"li"},"Playwright")," should use the official Playwright image: ",(0,r.kt)("a",{parentName:"li",href:"https://mcr.microsoft.com/en-us/product/playwright/about"},(0,r.kt)("inlineCode",{parentName:"a"},"mcr.microsoft.com/playwright:latest"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Web tests")," using ",(0,r.kt)("strong",{parentName:"li"},"WebdriverIO")," can use the official Puppeteer image: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/puppeteer/puppeteer/pkgs/container/puppeteer"},(0,r.kt)("inlineCode",{parentName:"a"},"ghcr.io/puppeteer/puppeteer:latest"))),(0,r.kt)("li",{parentName:"ul"},"Alternatively, ",(0,r.kt)("strong",{parentName:"li"},"web tests")," using ",(0,r.kt)("strong",{parentName:"li"},"WebdriverIO")," can also use a ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/node"},(0,r.kt)("inlineCode",{parentName:"a"},"node:lts"))," image and an attached ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/services/"},"GitLab CI service")," running Selenium Standalone, for example:\n",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/selenium/standalone-chrome"},(0,r.kt)("inlineCode",{parentName:"a"},"selenium/standalone-chrome:latest")),", or ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/selenium/standalone-firefox"},(0,r.kt)("inlineCode",{parentName:"a"},"selenium/standalone-firefox:latest"))),(0,r.kt)("li",{parentName:"ul"},"Additionally, if your organisation uses an in-house or external ",(0,r.kt)("a",{parentName:"li",href:"https://www.selenium.dev/documentation/grid/"},(0,r.kt)("strong",{parentName:"a"},"Selenium Grid")),", such as ",(0,r.kt)("a",{parentName:"li",href:"https://saucelabs.com/"},"SauceLabs")," or ",(0,r.kt)("a",{parentName:"li",href:"https://www.browserstack.com/"},"BrowserStack"),", you can use the ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/node"},(0,r.kt)("inlineCode",{parentName:"a"},"node:lts"))," image\nand connect your tests to the grid, as per the configuration instructions from your Selenium Grid provider")),(0,r.kt)("p",null,"Below example shows basic configuration of a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/yaml/gitlab_ci_yaml.html"},"GitLab CI Pipeline")," you can place in the ",(0,r.kt)("inlineCode",{parentName:"p"},".gitlab-ci.yml")," file in the root directory of your GitLab repository:"),(0,r.kt)(i.Z,{groupId:"code-examples",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"node",label:"Node",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"Node"}',title:'".gitlab-ci.yml"',tab:'{"label":"Node"}'},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: node:lts\n  script:\n    - npm ci\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n"))),(0,r.kt)(o.Z,{value:"playwright",label:"Playwright",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"Playwright"}',title:'".gitlab-ci.yml"',tab:'{"label":"Playwright"}'},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: mcr.microsoft.com/playwright:latest\n  script:\n    - npm ci\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n"))),(0,r.kt)(o.Z,{value:"webdriverio+puppeteer",label:"WebdriverIO+Puppeteer",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"WebdriverIO+Puppeteer"}',title:'".gitlab-ci.yml"',tab:'{"label":"WebdriverIO+Puppeteer"}'},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: ghcr.io/puppeteer/puppeteer:latest\n  script:\n    - npm ci\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n"))),(0,r.kt)(o.Z,{value:"webdriverio+selenium-standalone",label:"WebdriverIO+Selenium Standalone",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"WebdriverIO+Selenium Standalone"}',title:'".gitlab-ci.yml"',tab:'{"label":"WebdriverIO+Selenium','Standalone"}':!0},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: node:lts\n  services:\n    - selenium/standalone-chrome\n  script:\n    - npm ci\n\n    # configure your tests to use Selenium Grid at\n    # selenium__standalone-chrome:4444\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"How a GitLab CI pipeline works"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When a code change is pushed to your ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/user/project/repository/"},"source control repository"),", GitLab CI runs your code through the ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/yaml/#stages"},(0,r.kt)("inlineCode",{parentName:"a"},"stages"))," of a pipeline you've defined in your pipeline configuration file.\nThe pipeline in our example has one stage so far: ",(0,r.kt)("inlineCode",{parentName:"li"},"test"),", however most pipelines will have additional stages like ",(0,r.kt)("inlineCode",{parentName:"li"},"build"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"report"),", or ",(0,r.kt)("inlineCode",{parentName:"li"},"deploy"),"."),(0,r.kt)("li",{parentName:"ul"},"Each pipeline stage can have multiple ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/jobs/"},"jobs"),", in this case a job called ",(0,r.kt)("inlineCode",{parentName:"li"},"serenity")," provisions a Docker container specified as ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/yaml/#image"},(0,r.kt)("inlineCode",{parentName:"a"},"image")),", checks out your code, and invokes a ",(0,r.kt)("inlineCode",{parentName:"li"},"script")," responsible for running your automated tests."),(0,r.kt)("li",{parentName:"ul"},"In our example, ",(0,r.kt)("inlineCode",{parentName:"li"},"script")," runs:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"npm ci"),", which installs the Node.js modules that your automation projects depends on"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"npm test"),", which invokes the ",(0,r.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v8/commands/npm-test"},(0,r.kt)("inlineCode",{parentName:"a"},"test")," script")," defined in your ",(0,r.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v9/configuring-npm/package-json"},(0,r.kt)("inlineCode",{parentName:"a"},"package.json"))))),(0,r.kt)("li",{parentName:"ul"},"Since all the ",(0,r.kt)("a",{parentName:"li",href:"/handbook/getting-started/project-templates/"},(0,r.kt)("strong",{parentName:"a"},"Serenity/JS Project Templates"))," are configured to run tests via ",(0,r.kt)("inlineCode",{parentName:"li"},"npm test")," and produce ",(0,r.kt)("a",{parentName:"li",href:"/handbook/reporting/serenity-bdd-reporter"},"Serenity BDD reports")," under ",(0,r.kt)("inlineCode",{parentName:"li"},"target/site/serenity"),",\nwe configure GitLab to archive any ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/yaml/#artifacts"},(0,r.kt)("inlineCode",{parentName:"a"},"artifacts"))," under ",(0,r.kt)("inlineCode",{parentName:"li"},"target"),". This way you can ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/jobs/job_artifacts.html"},"inspect them in GitLab UI")," or use them in subsequent stages of your pipeline.")),(0,r.kt)("h2",{id:"generating-serenity-bdd-reports"},"Generating Serenity BDD reports"),(0,r.kt)("p",null,"Serenity/JS uses ",(0,r.kt)("a",{parentName:"p",href:"/handbook/reporting/serenity-bdd-reporter"},"Serenity BDD CLI")," to generate Serenity BDD HTML reports and living documentation. Serenity BDD CLI is a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/serenity-bdd/serenity-core/tree/main/serenity-cli"},"Java program")," downloaded and managed by Serenity/JS.\nHowever, since Serenity BDD CLI is a Java program, it requires a Java Runtime Environment (JRE) which might not be available in your Docker image."),(0,r.kt)("p",null,"If the Docker image you use doesn't offer a Java Runtime Environment (JRE), you can:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Install a JRE as part of your GitLab CI job"),(0,r.kt)("li",{parentName:"ul"},"Create a custom Docker image with both Node.js and a JRE")),(0,r.kt)("h3",{id:"installing-a-java-runtime-environment"},"Installing a Java Runtime Environment"),(0,r.kt)("p",null,"To install a JRE before running the tests, add ",(0,r.kt)("inlineCode",{parentName:"p"},"apt-get update && apt-get install default-jre -y")," to your GitLab CI script:"),(0,r.kt)(i.Z,{groupId:"code-examples",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"node",label:"Node",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"Node"}',title:'".gitlab-ci.yml"',tab:'{"label":"Node"}'},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: node:lts\n  script:\n    // highlight-next-line\n    - apt-get update && apt-get install default-jre -y\n    - npm ci\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n"))),(0,r.kt)(o.Z,{value:"playwright",label:"Playwright",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"Playwright"}',title:'".gitlab-ci.yml"',tab:'{"label":"Playwright"}'},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: mcr.microsoft.com/playwright:latest\n  script:\n    // highlight-next-line\n    - apt-get update && apt-get install default-jre -y\n    - npm ci\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n"))),(0,r.kt)(o.Z,{value:"webdriverio+puppeteer",label:"WebdriverIO+Puppeteer",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"WebdriverIO+Puppeteer"}',title:'".gitlab-ci.yml"',tab:'{"label":"WebdriverIO+Puppeteer"}'},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: ghcr.io/puppeteer/puppeteer:latest\n  script:\n    // highlight-next-line\n    - apt-get update && apt-get install default-jre -y\n    - npm ci\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n"))),(0,r.kt)(o.Z,{value:"webdriverio+selenium-standalone",label:"WebdriverIO+Selenium Standalone",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml" tab={"label":"WebdriverIO+Selenium Standalone"}',title:'".gitlab-ci.yml"',tab:'{"label":"WebdriverIO+Selenium','Standalone"}':!0},"stages:\n  - test\n\nserenity:\n  stage: test\n  image: node:lts\n  services:\n    - selenium/standalone-chrome\n  script:\n    // highlight-next-line\n    - apt-get update && apt-get install default-jre -y\n    - npm ci\n\n    # configure your tests to use Selenium Grid at\n    # selenium__standalone-chrome:4444\n    - npm test\n  artifacts:\n    when: always\n    paths:\n      - target\n\n# other configuration\n")))),(0,r.kt)("h3",{id:"building-a-custom-docker-image"},"Building a custom Docker image"),(0,r.kt)("p",null,"To avoid installing the Java Runtime Environment every time your GitLab CI pipeline runs, you might prefer to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/build/building/packaging/"},"build a custom Docker image"),",\npublish it to your organisation's artifact registry, and use that image instead."),(0,r.kt)("p",null,"To add a JRE to your base Docker image of choice, use a ",(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile")," like in the example below:"),(0,r.kt)(i.Z,{groupId:"code-examples",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"node",label:"Node",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-docker",metastring:'title="Dockerfile" tab={"label":"Node"}',title:'"Dockerfile"',tab:'{"label":"Node"}'},"FROM node:lts\n\nRUN apt-get update \\\n && apt-get install default-jre -y \\\n && apt-get clean\n"))),(0,r.kt)(o.Z,{value:"playwright",label:"Playwright",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-docker",metastring:'title="Dockerfile" tab={"label":"Playwright"}',title:'"Dockerfile"',tab:'{"label":"Playwright"}'},"FROM mcr.microsoft.com/playwright:latest\n\nRUN apt-get update \\\n && apt-get install default-jre -y \\\n && apt-get clean\n"))),(0,r.kt)(o.Z,{value:"webdriverio+puppeteer",label:"WebdriverIO+Puppeteer",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-docker",metastring:'title="Dockerfile" tab={"label":"WebdriverIO+Puppeteer"}',title:'"Dockerfile"',tab:'{"label":"WebdriverIO+Puppeteer"}'},"FROM ghcr.io/puppeteer/puppeteer:latest\n\nRUN apt-get update \\\n && apt-get install default-jre -y \\\n && apt-get clean\n")))),(0,r.kt)("p",null,"Next, build and publish your Docker image as per the instructions from your artifact registry vendor:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://jfrog.com/help/r/jfrog-artifactory-documentation/docker-registry"},'Artifactory: "Docker registry"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry"},'GitHub: "Working with the Container registry"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/user/packages/container_registry/build_and_push_images.html"},'GitLab: "Build and push container images to the Container Registry"'))),(0,r.kt)("h2",{id:"publishing-serenity-bdd-reports-to-gitlab-pages"},"Publishing Serenity BDD reports to GitLab Pages"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/pages/"},"GitLab Pages")," is a feature of GitLab CI that allows you to publish static HTML websites, such as Serenity BDD HTML reports,\nand share them with your team."),(0,r.kt)("p",null,"GitLab Pages rely on convention over configuration, so to use this feature your pipeline needs to meet the below criteria:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You must declare a GitLab CI job called ",(0,r.kt)("inlineCode",{parentName:"li"},"pages")," in your ",(0,r.kt)("inlineCode",{parentName:"li"},".gitlab-ci.yml")),(0,r.kt)("li",{parentName:"ul"},"There must be an explicit dependency between the ",(0,r.kt)("inlineCode",{parentName:"li"},"serenity")," job and the ",(0,r.kt)("inlineCode",{parentName:"li"},"pages")," job so that the ",(0,r.kt)("inlineCode",{parentName:"li"},"artifacts")," are propagated between the stages of your pipeline"),(0,r.kt)("li",{parentName:"ul"},"Any static content you wish to publish must be moved to a directory called ",(0,r.kt)("inlineCode",{parentName:"li"},"public"))),(0,r.kt)("p",null,"Additionally, since GitLab Pages are ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/pages/introduction.html#gitlab-ciyml-for-a-repository-with-code"},"branch/tag agnostic"),",\nyou should use ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/yaml/#rulesif"},(0,r.kt)("inlineCode",{parentName:"a"},"rules:if"))," to limit their deployment only to builds executed\non the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/repository/branches/default.html"},"default branch")," in your repository."),(0,r.kt)("p",null,"To publish your Serenity BDD reports to GitLab Pages, add a ",(0,r.kt)("inlineCode",{parentName:"p"},"pages")," job to your ",(0,r.kt)("inlineCode",{parentName:"p"},".gitlab-ci.yml")," as per the example below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml"',title:'".gitlab-ci.yml"'},"stages:\n  - test\n  - publish\n\nserenity:\n  # ...\n\npages:\n  stage: publish\n  dependencies:\n    - serenity\n  script:\n    - mv target/site/serenity public\n  artifacts:\n    paths:\n      - public\n  rules:\n    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\n")),(0,r.kt)("p",null,"Note that GitLab Pages for repositories hosted on ",(0,r.kt)("a",{parentName:"p",href:"https://gitlab.com"},"gitlab.com")," are published to ",(0,r.kt)("em",{parentName:"p"},"gitlab.io"),".\nFor example, project hosted at ",(0,r.kt)("inlineCode",{parentName:"p"},"gitlab.com/my-group/my-project")," will have its GitLab Pages published to ",(0,r.kt)("inlineCode",{parentName:"p"},"my-group.gitlab.io/my-project"),"."),(0,r.kt)("p",null,"Consult GitLab documentation to learn more about the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/pages/getting_started_part_one.html"},"GitLab Pages URL structure"),"."),(0,r.kt)("h2",{id:"generating-junit-reports"},"Generating JUnit reports"),(0,r.kt)("p",null,"GitLab CI recognises test execution reports that conform to the ",(0,r.kt)("a",{parentName:"p",href:"https://llg.cubic.org/docs/junit/"},(0,r.kt)("strong",{parentName:"a"},"JUnit XML standard")),".\nSerenity/JS integrates with all the ",(0,r.kt)("strong",{parentName:"p"},"native reporters")," offered by the supported ",(0,r.kt)("a",{parentName:"p",href:"/handbook/test-runners/"},"test runners"),",\nincluding the ones producing JUnit reports, such as:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/cucumber/cucumber-js/blob/main/docs/formatters.md#junit"},"Cucumber.js JUnit formatter")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/jasmine-reporters"},"Jasmine JUnit reporter")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/mocha-junit-reporter"},"Mocha JUnit reporter")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://playwright.dev/docs/test-reporters#junit-reporter"},"Playwright Test JUnit reporter")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://webdriver.io/docs/junit-reporter/"},"WebdriverIO"))),(0,r.kt)("p",null,"To make GitLab CI recognise a JUnit-standard report produced by your Serenity/JS test suite and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/testing/unit_test_reports.html"},"surface test results in your Merge Requests"),", you should:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use a native JUnit reporter appropriate for your test runner"),(0,r.kt)("li",{parentName:"ul"},"Configure ",(0,r.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/ci/testing/unit_test_reports.html"},(0,r.kt)("inlineCode",{parentName:"a"},"artifacts:reports:junit")),"  to tell GitLab where to find the report.")),(0,r.kt)("p",null,"For example, if you have configured your JUnit reporter to produce a report at ",(0,r.kt)("inlineCode",{parentName:"p"},"target/junit-results.xml"),", you can configure your GitLab CI job as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".gitlab-ci.yml"',title:'".gitlab-ci.yml"'},"stages:\n  - test\n\nserenity:\n  stage: test\n  # ...\n  artifacts:\n    when: always\n    paths:\n      - target\n    # highlight-start\n    reports:\n      junit: target/junit-results.xml\n    # highlight-end\n\n# other configuration\n")),(0,r.kt)("admonition",{title:"Pro Tip",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Note that in the above example I use ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/ci/yaml/#artifactswhen"},(0,r.kt)("inlineCode",{parentName:"a"},"artifacts:when: always")),".\nThis instructs GitLab to upload and analyse the test report even when the test run fails, which is exactly when you need your test reports the most \ud83d\ude0a")),(0,r.kt)("h2",{id:"next-steps"},"Next steps"),(0,r.kt)("p",null,"Congratulations! \ud83e\udd73 You've just learnt how to run your Serenity/JS test scenarios on GitLab CI!\nIf you enjoyed this tutorial, please leave a \ud83d\udc4d in the reactions section below."),(0,r.kt)("p",null,"New tutorials and videos are coming soon, follow ",(0,r.kt)("a",{parentName:"p",href:"https://www.linkedin.com/company/serenity-js"},"Serenity/JS on LinkedIn")," and subscribe to ",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/channel/UC0RdeVPyjtJopVHvlLrXd1Q"},"Serenity/JS YouTube channel")," to get notified when they're available!"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.linkedin.com/company/serenity-js"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/Follow%20Serenity%2FJS-0077B5?style=for-the-badge&logo=linkedin&logoColor=white",alt:"LinkedIn Follow"})),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/@serenity-js"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/Watch%20@serenity--js-E62117?style=for-the-badge&logo=youtube&logoColor=white",alt:"YouTube Follow"}))),(0,r.kt)("admonition",{title:"Help us help you",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Serenity/JS is a free open-source framework, so we rely on our ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sponsors/serenity-js"},"wonderful GitHub sponsors")," to keep the lights on."),(0,r.kt)("p",{parentName:"admonition"},"If you appreciate all the effort that goes into making sophisticated tools easy to work with, please support our work and become a Serenity/JS GitHub Sponsor today!"),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/sponsors/serenity-js"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/Support%20@serenity%2FJS-703EC8?style=for-the-badge&logo=github&logoColor=white",alt:"GitHub Sponsors"})))))}g.isMDXComponent=!0}}]);